#!/usr/bin/env ruby
APP_PATH = File.expand_path('../../config/application',  __dir__)
require_relative '../config/boot'
require_relative '../config/environment'

require 'csv'

all_services = ["basic_client_services", "client_records", "basic_laboratory_tests",
                "advanced_laboratory_tests", "diagnostic_equipment", "child_health_services",
                "family_planning_services", "anc_services", "pmtct_services", "malaria_services",
                "maternal_health_services", "emergency_obstetric_care", "hiv_testing_and_counseling_services",
                "non_communicable_disease__ncd", "tuberculosis_services", "tb_treatment",
                "neglected_tropical_disease__ntd", "regular_electricity", "power_source", "regular_water",
                "water_source", "visual_and_auditory_privacy", "latrine_type", "regular_communication",
                "communication_equipment", "ambulance", "avg_travel_time_amb_stat", "medical_specialist",
                "general_practicioner", "health_officer___integrated_emergency_surgical_officer", "bsc_nurse",
                "diploma_nurse", "specialized_nurse", "diploma_midwife", "pharmacy_professionals",
                "med_lab_professionals", "other_paramedics", "health_extension_worker", "supportive_staff"
               ]

filename = ARGV[0]
output   = ARGV[1]

CSV.open(output, "wb") do |csv|
  csv << [
    "resmap-id",
    "name",
    "lat",
    "long",
    "services",
    "administrative_boundaries",
    "administrative_boundaries-1",
    "administrative_boundaries-2",
    "administrative_boundaries-3",
    "administrative_boundaries-4",
    "report_to",
    "poc_email",
    "poc_phonenumber",
    "pocname",
    "facility_type",
    "last updated"
  ]
  CSV.foreach(filename, headers: true) do |row|
    csv << [
      row["resmap-id"],
      row["name"],
      row["lat"],
      row["long"],
      all_services.sample(rand(5)).join('|'),
      row["administrative_boundaries"],
      row["administrative_boundaries-1"],
      row["administrative_boundaries-2"],
      row["administrative_boundaries-3"],
      row["administrative_boundaries-4"],
      row["report_to"],
      row["poc_email"],
      row["poc_phonenumber"],
      row["pocname"],
      row["facility_type"],
      row["last updated"]
    ]
  end
end
